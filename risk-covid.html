<!DOCTYPE html>
<html>
  <head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155991615-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "UA-155991615-1");
    </script>

    <!-- metaphysics -->
    <meta charset="utf-8">
    <title>COVID-19 disease risks</title>
    <meta name="author" content="Markus Mannheim">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- scripts -->
    <script src="./resources/d3.v6.min.js"></script>
    <script src="./scripts/scripts.js"></script>
    <link href="./resources/style.css" rel="stylesheet">
    <link href="./resources/risk-covid.css" rel="stylesheet">
    <link href="./resources/abcLogo64.png" rel="icon">
  </head>

  <body>

    <script>
      // set up page
      type = "viz";
      pageSetUp(
        type, // viz type
        false, // no header
        false // no footer
      );

      // disease data
      diseaseData = {
        notSevere: 42758,
        hospitalised: 6515,
        icu: 896,
        dead: 296
      };

      // activate
      window.addEventListener("resize", function() {
        resize(type);
        redraw();
      });
      resize(type);

      sample = 1000;
      data = d3.range(sample)
        .map(function(d) { return {
          x: d3.randomNormal(width / 2, width / 8)(),
          y: d3.randomNormal(height / 2, height / 8)()
        }; });
      radius = 8
      nodes = vizGroup
        .selectAll(".node")
          .data(data, function(d, i) { return i; })
          .join("circle")
            .attr("class", function(d, i) {
              if ( i < 296 / 50465 * sample) {
                return "node dead";
              } else if ( i < (296 + 896) / 50465 * sample) {
                return "node icu"
              } else if ( i < (296 + 896 + 6515) / 50465 * sample) {
                return "node hospital"
              } else {
                return "node";
              }
            })
            .attr("r", radius);

      simulation = d3.forceSimulation(data)
        .force("charge", d3.forceManyBody().strength(.5))
        // .force("center", d3.forceCenter(width / 2, height / 2))
        .force("collision", d3.forceCollide().radius(radius))
        .force("x", d3.forceX().x(function(d, i) {
      		return i % 2 == 0 ? width / 4 : width / 4 * 3;
      	}))
        // .force("y", d3.forceY().y(height / 2))
        .on("tick", ticked);

      function ticked() {
        nodes.attr("cx", function(d) { return d.x; })
          .attr("cy", function(d) { return d.y; });
      }

      function redraw() {
        simulation.force("center", d3.forceCenter(width / 2, height / 2))
          .restart();
      }
    </script>
  </body>
</html>
