<!DOCTYPE html>
<html>
  <head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155991615-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "UA-155991615-1");
    </script>

    <!-- metaphysics -->
    <meta charset="utf-8">
    <title>COVID-19 disease risks</title>
    <meta name="author" content="Markus Mannheim">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- scripts -->
    <script src="./resources/d3.v6.min.js"></script>
    <script src="./scripts/scripts.js"></script>
    <link href="./resources/style.css" rel="stylesheet">
    <link href="./resources/risk-covid.css" rel="stylesheet">
    <link href="./resources/abcLogo64.png" rel="icon">
  </head>

  <body>

    <script>
      // set up page
      type = "viz";
      pageSetUp(
        type, // viz type
        false, // no header
        false // no footer
      );

      // disease data
      diseaseData = {
        hospital: 9446,
        icu: 1156,
        dead: 435
      };
      diseaseTotal = 62927;

      // activate
      window.addEventListener("resize", function() {
        resize(type);
        redraw();
      });
      resize(type);

      sample = 1000;
      data = d3.range(sample)
        .map(function(d, i) { return {
          class: (
            i < diseaseData.dead / diseaseTotal * sample ? "dead" :
            i < (diseaseData.dead + diseaseData.icu) / diseaseTotal * sample ? "icu" :
            i < (diseaseData.dead + diseaseData.hospital) / diseaseTotal * sample ? "hospital" :
            "notSevere"
          )
        }; });
      radius = 7;

      nodes = vizGroup
        .selectAll(".node")
          .data(data, function(d, i) { return i; })
        .enter().append("circle")
          .attr("class", function(d) { return d.class + " node"; })
          .attr("r", radius);

      simulation = d3.forceSimulation(data)
        .force("charge", d3.forceManyBody().strength(.75))
        .force("collision", d3.forceCollide().radius(radius + 1))
        .force("center", d3.forceCenter(width / 2, height / 2))
        // .force("x", d3.forceY().y(width / 2))
        .on("tick", ticked);

      function ticked() {
        nodes.attr("cx", function(d) { return d.x; })
          .attr("cy", function(d) { return d.y; });
      }

      function redraw() {
        simulation.force("center", d3.forceCenter(width / 2, height / 2))
          .restart();
      }
    </script>
  </body>
</html>
